{% extends 'layout.html' %}
{% block page_title %}Dashboard{% endblock %}
{% block content %}
<div class="grid" style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
  <div class="card">
    <h3>Activité</h3>
    <canvas id="chartActivity" height="120"></canvas>
  </div>
  <div class="card">
    <h3>Répartition par type</h3>
    <canvas id="chartTypes" height="120"></canvas>
  </div>
</div>
<div class="card">
  <h3>Dernières activités (cessions)</h3>
  <table width="100%" cellspacing="0" cellpadding="8" style="border-collapse:collapse">
    <thead>
      <tr><th>Date</th><th>Société</th><th>Détail</th><th>Parts</th></tr>
    </thead>
    <tbody>
      {% for c in last_cessions %}
      <tr>
        <td>{{ c.date }}</td>
        <td>{{ c.societe.name if c.societe else '' }}</td>
        <td>{{ c.cedant }} → {{ c.cessionnaire }}</td>
        <td style="text-align:right">{{ c.parts_count }}</td>
      </tr>
      {% else %}
      <tr><td colspan="4" style="text-align:center;color:#6b7280">Aucune activité</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
fetch("/dashboard/data/companies-by-type.json").then(r=>r.json()).then(data=>{
  new Chart(document.getElementById('chartTypes').getContext('2d'),{
    type:'bar',data:{labels:data.labels,datasets:[{label:'Sociétés',data:data.values,backgroundColor:'#4f46e5'}]}
  });
});
</script>
{% endblock %}
